import{j as e,M as A,r as y,b as f,c as p,B as v,f as D}from"./index-yE4_gdNy.js";import{d as x}from"./DashboardStyle-DyR8Cuft.js";const u=({title:r,extra:d,children:i,style:t})=>e.jsxs("div",{style:{background:"var(--card)",borderRadius:16,padding:20,...t},children:[(r||d)&&e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12},children:[typeof r=="string"?e.jsx("strong",{children:r}):r,d]}),i]}),k=r=>e.jsx(A,{...r}),R=({open:r,onClose:d,asset:i})=>e.jsx(k,{open:r,onCancel:d,onOk:d,title:i.name,footer:null,maskClosable:!0,children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:16},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("strong",{children:"Total"}),e.jsx("span",{style:{fontSize:18},children:i.totalCount})]}),e.jsxs("div",{children:[e.jsx("strong",{style:{display:"block",marginBottom:8},children:"Classifications"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr",gap:12},children:i.classifications.map((t,s)=>{const o=typeof t.workingCount=="number"||typeof t.notWorkingCount=="number",h=t.workingCount??0,l=t.notWorkingCount??0,c=t.count?Math.round(h/t.count*100):0,a=t.count?Math.round(l/t.count*100):0;return e.jsxs("div",{style:{border:"1px solid #eee",borderRadius:8,padding:12},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:8},children:[e.jsx("span",{style:{color:"#666"},children:t.name}),e.jsx("strong",{children:t.count})]}),o&&e.jsxs("div",{style:{display:"flex",gap:12},children:[e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{fontSize:12,color:"#4b5563",marginBottom:4},children:"Working"}),e.jsx("div",{style:{height:8,background:"#e5e7eb",borderRadius:4,overflow:"hidden"},children:e.jsx("div",{style:{width:`${c}%`,background:"#10b981",height:"100%"}})}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:12,marginTop:4},children:[e.jsxs("span",{style:{color:"#6b7280"},children:[c,"%"]}),e.jsx("strong",{children:h})]})]}),e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{fontSize:12,color:"#4b5563",marginBottom:4},children:"Not Working"}),e.jsx("div",{style:{height:8,background:"#e5e7eb",borderRadius:4,overflow:"hidden"},children:e.jsx("div",{style:{width:`${a}%`,background:"#ef4444",height:"100%"}})}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:12,marginTop:4},children:[e.jsxs("span",{style:{color:"#6b7280"},children:[a,"%"]}),e.jsx("strong",{children:l})]})]})]})]},s)})})]})]})}),C=({asset:r,onFetch:d,assetType:i,style:t})=>{const[s,o]=y.useState(r),[h,l]=y.useState(!1),[c,a]=y.useState(!1),m=f(n=>n.editMode),S=p(n=>n.removeAsset),[w,j]=y.useState(!1),b=async()=>{if(!m)if(!s&&d){l(!0);try{const n=await d(i);o(n),a(!0)}catch(n){console.error("Failed to fetch asset data:",n)}finally{l(!1)}}else s&&a(!0)};return h?e.jsx(u,{style:{...g,cursor:"pointer",...t},children:e.jsx("div",{style:z,children:"Loading..."})}):s?e.jsxs(e.Fragment,{children:[e.jsx(u,{style:{...g,cursor:"pointer",...t},children:e.jsx("div",{onClick:b,children:e.jsxs("div",{style:T,children:[e.jsxs("div",{style:{flex:1},children:[e.jsx("p",{style:B,children:s.name}),e.jsx("h2",{style:M,children:s.totalCount})]}),m&&e.jsx("button",{onClick:n=>{n.stopPropagation(),j(!0)},style:{position:"absolute",top:8,right:8,width:24,height:24,borderRadius:12,border:"1px solid #e5e7eb",background:"#fff",color:"#ef4444",cursor:"pointer",lineHeight:"22px",textAlign:"center"},"aria-label":"Remove card",title:"Remove card",children:"Ã—"})]})})}),e.jsx(R,{open:c,onClose:()=>a(!1),asset:{id:s.id,name:s.name,totalCount:s.totalCount,classifications:s.classifications.map(n=>({name:n.name,count:n.count,workingCount:n.workingCount,notWorkingCount:n.notWorkingCount}))}}),e.jsxs(k,{open:w,title:"Remove card?",okText:"Remove",cancelText:"Cancel",onOk:()=>{S(s.id),j(!1)},onCancel:()=>j(!1),children:['Are you sure you want to remove "',s.name,'" from the dashboard?']})]}):e.jsx(u,{style:{...g,cursor:"pointer",opacity:.6,...t},children:e.jsxs("div",{onClick:b,style:I,children:[e.jsx("div",{style:{fontSize:32,marginBottom:8},children:"+"}),e.jsx("p",{style:{margin:0,fontSize:14},children:"Click to load"})]})})},g={transition:"all 0.3s ease",cursor:"pointer",minHeight:140},T={display:"flex",alignItems:"center",justifyContent:"space-between"},B={margin:0,fontSize:14,color:"#888",marginBottom:8},M={margin:0,fontSize:36,fontWeight:"bold"},I={display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:120,color:"#999"},z={display:"flex",alignItems:"center",justifyContent:"center",height:120,color:"#999"},E=()=>{const{assets:r,reorderAssets:d}=p(),i=f(o=>o.editMode),t=f(o=>o.toggleEdit),s=async o=>await D(o);return e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:12},children:[e.jsx("div",{}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(v,{onClick:()=>p.getState().addAssetFromType("hydrants"),children:"Add Hydrants"}),e.jsx(v,{type:i?"primary":"default",onClick:t,children:i?"Done":"Edit"})]})]}),e.jsxs("div",{style:x.cards,children:[r.map((o,h)=>e.jsx("div",{draggable:i,onDragStart:l=>{l.dataTransfer.setData("text/plain",String(h))},onDragOver:l=>i&&l.preventDefault(),onDrop:l=>{if(!i)return;const c=Number(l.dataTransfer.getData("text/plain")),a=h;!Number.isNaN(c)&&c!==a&&d(c,a)},style:{position:"relative"},children:e.jsx(C,{asset:o})},o.id)),e.jsx(C,{onFetch:s,assetType:"hydrants"})]}),e.jsxs("div",{style:x.chart,children:[e.jsx("strong",{children:"Monthly Leak Reports"}),e.jsx("div",{style:{height:200,color:"#999"},children:"(You can plug chart here using Recharts or Chart.js)"})]}),e.jsxs("div",{style:x.table,children:[e.jsx("strong",{children:"Leak Reports"}),e.jsxs("table",{width:"100%",style:{marginTop:12,fontSize:14},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{textAlign:"left",color:"#888"},children:[e.jsx("th",{children:"Reference No."}),e.jsx("th",{children:"Leak Type"}),e.jsx("th",{children:"Address"}),e.jsx("th",{children:"Status"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:"202601BA61"}),e.jsx("td",{children:"Mainline"}),e.jsx("td",{children:"B4-7 P2 NHA ALPHA HOMES"}),e.jsx("td",{children:e.jsx("span",{style:x.statusGreen,children:"DISPATCHED"})})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"2025126F88"}),e.jsx("td",{children:"ServiceLine"}),e.jsx("td",{children:"PRK II BAGO GALLERA"}),e.jsx("td",{children:e.jsx("span",{style:x.statusYellow,children:"UN-DISPATCH"})})]})]})]})]})]})};export{E as default};
